define(function(require){function loadData(type){setting.type=type,getElements(type,function(dom,func){waterfall.$container.empty(),waterfall.$columns.remove(),waterfall.$columns=creatColumn(),render(dom,!0,func)})}function creatColumn(){waterfall.column_num=calculateColumns();var html=setting.createColumn(setting,waterfall.column_num);return $container.prepend(html),$("."+setting.column_className,$container)}function calculateColumns(){var num=Math.floor($container.innerWidth()/(setting.column_width+setting.column_space));return 1>num&&(num=1),num}function render(elements,fadein,callback){if($(elements).length){{waterfall.$columns}$(elements).each(function(i){if(!setting.auto_imgHeight||2==setting.insert_type)return 1==setting.insert_type?insert($(elements).eq(i),setting.fadein&&fadein):2==setting.insert_type&&insert2($(elements).eq(i),i,setting.fadein&&fadein),!0;if("img"==$(this)[0].nodeName.toLowerCase()||$(this).find(setting.img_selector).length>0){var image=new Image,src="img"==$(this)[0].nodeName.toLowerCase()?$(this).attr("src"):$(this).find(setting.img_selector).attr("src");image.onload=function(){image.onreadystatechange=null,1==setting.insert_type?insert($(elements).eq(i),setting.fadein&&fadein):2==setting.insert_type&&insert2($(elements).eq(i),i,setting.fadein&&fadein),image=null},image.onreadystatechange=function(){"complete"==image.readyState&&(image.onload=null,1==setting.insert_type?insert($(elements).eq(i),setting.fadein&&fadein):2==setting.insert_type&&insert2($(elements).eq(i),i,setting.fadein&&fadein),image=null)},image.src=src}else 1==setting.insert_type?insert($(elements).eq(i),setting.fadein&&fadein):2==setting.insert_type&&insert2($(elements).eq(i),i,setting.fadein&&fadein)}),callback&&callback()}}function public_render(elems,callback){render(elems,!0,callback)}function insert($element,fadein){fadein?$element.css("opacity",0).appendTo(waterfall.$columns.eq(calculateLowest())).animate({opacity:1}):$element.appendTo(waterfall.$columns.eq(calculateLowest())),setting.itemInit($element)}function insert2($element,i,fadein){fadein?$element.css("opacity",0).appendTo(waterfall.$columns.eq(i%waterfall.column_num)).animate({opacity:1}):$element.appendTo(waterfall.$columns.eq(i%waterfall.column_num)),setting.itemInit($element)}function calculateLowest(){var min=waterfall.$columns.eq(0).outerHeight(),min_key=0;return waterfall.$columns.each(function(i){$(this).outerHeight()<min&&(min=$(this).outerHeight(),min_key=i)}),min_key}function getElements(type,callback){return $.waterfall.load_index++,setting.getColumnItems($.waterfall.load_index,type,callback)}function onScroll(){clearTimeout(waterfall._scrollTimer),waterfall._scrollTimer=setTimeout(function(){var $lowest_column=waterfall.$columns.eq(calculateLowest()),bottom=$lowest_column.offset().top+$lowest_column.outerHeight(),scrollTop=document.documentElement.scrollTop||document.body.scrollTop||0,windowHeight=document.documentElement.clientHeight||document.body.clientHeight||0;scrollTop>=bottom-windowHeight+100&&getElements(setting.type,function(dom,func){render(dom,!0,func)})},100)}function onResize(){if(calculateColumns()!=waterfall.column_num){var $cells=waterfall.$container.find(setting.cell_selector);waterfall.$columns.remove(),waterfall.$columns=creatColumn(),render($cells,!1)}}var win=window,doc=win.document,magazine=(require("interface"),function(ops){return new magazine.fn.init(ops)});magazine.fn=magazine.prototype={init:function(ops){jQuery.extend(this,ops);var self=this;return self.getMagazineItems(function(html){jQuery(self.list).html(html)}),this}},magazine.fn.init.prototype=magazine.fn;var searchbox=function(ops){return new searchbox.fn.init(ops)};searchbox.fn=searchbox.prototype={init:function(ops){jQuery.extend(this,ops);var self=this;return self.inputbox=jQuery(self.input),self.inputbox.on("keyup",function(){jQuery.trim(jQuery(this).val()||""),jQuery.trim(jQuery(self.input).attr("data-deftext")||"")}).click(function(){var def=jQuery(this).attr("data-deftext"),val=jQuery(this).val();val==def&&jQuery(this).val("").removeClass("color_gray")}).blur(function(){var def=jQuery(this).attr("data-deftext"),val=jQuery(this).val();""==jQuery.trim(val)&&jQuery(this).val(def).addClass("color_gray")}),self.form=jQuery(self.dom),self.form.on("submit",function(e){e.preventDefault(),self.verificat()&&self.send()}),self.submitButton=jQuery(self.submit),self.submitButton.on("click",function(e){e.preventDefault(),self.verificat()&&self.send()}),self.getHotword(self.inputbox),self.getKeyItems(function(html){jQuery(self.keybox).html(html)}),this},verificat:function(){{var self=this,keys=jQuery.trim(self.inputbox.val()||"");jQuery.trim(self.inputbox.attr("data-deftext")||"")}return""==keys?(alert("输入内容不能为空，请重新输入！"),!1):keys.getLength(!0)<2?(alert("请正确输入关键词！"),!1):(self.datas={key:encodeURIComponent(keys)},!0)},send:function(){var self=this;self.form[0].submit()}},searchbox.lenovo=function(){return[]},searchbox.fn.init.prototype=searchbox.fn;var slideAd=function(ops){return new slideAd.fn.init(ops)};slideAd.fn=slideAd.prototype={init:function(ops){var self=this;return jQuery.extend(self,ops),self.getBannerItem(self,function(){self.refresh().eventInit(),jQuery(window).on("resize",function(){self.refresh()})}),this},eventInit:function(){var self=this;return jQuery(self.list+" a").hover(function(){var index=jQuery(this).index();self.activeIndex=index,self.SwitchTime&&clearTimeout(self.SwitchTime),self.SwitchTime=setTimeout(function(){self.stop().Switch(index)},self.waitTime)},function(){self.stop(!1).play(self.activeIndex)}),this},refresh:function(){var self=this;return self.items=jQuery(self.view+" div"),self.itemWidth=jQuery(window).width(),self.itemHeight=self.items.eq(0).height(),jQuery(self.view+" div").css({position:"absolute"}).each(function(){var img=jQuery("img",this),src=img.attr("src");img.hide(),jQuery(this).css({opacity:0,top:0,left:0,background:"#fff url("+src+") no-repeat top center",width:jQuery(this).parent().width(),height:self.itemHeight,display:"block"})}),jQuery(self.list).stop().animate({right:jQuery(win).width()<1200?"0":"112px"}),self.play(0),this},play:function(index){var self=this;return self.playTimeout&&clearTimeout(self.playTimeout),self.playTimeout=setTimeout(function(){self.Switch(index,function(){self.isPause||(index=index++>=self.items.length?0:index++,self.play(index))})},self.intervalTime),this},stop:function(bool){var self=this;return self.playTimeout&&clearTimeout(self.playTimeout),self.isPause="undefined"!=typeof bool?bool:!0,this},Switch:function(index,callback){var self=this;return self.activeIndex=index,jQuery.when(self.items.eq(index).siblings().css({zIndex:1,left:0}).animate({opacity:0},self.time),self.items.eq(index).css({left:0,zIndex:2}).animate({opacity:1},self.time)).done(function(){callback&&callback()}),this},next:function(){var index=self.activeIndex+1>self.items.length?0:self.activeIndex+1;return this.play(index),this},prev:function(){var index=self.activeIndex-1<0?0:self.activeIndex-1;return this.play(index),this}},slideAd.fn.init.prototype=slideAd.fn;var setting={column_width:204,column_className:"waterfall_column",column_space:10,cell_selector:".cell",img_selector:"img",auto_imgHeight:!0,fadein:!0,fadein_speed:600,insert_type:1,getColumnItems:function(){},onRefresh:function(){},getNavItems:function(){},createColumn:function(){}},waterfall=$.waterfall={},$container=null;waterfall.load_index=0,$.fn.extend({waterfall:function(opt){opt=opt||{},setting=$.extend(setting,opt),$container=waterfall.$container=$(this),setting.getNavItems(setting.type,function(dom,callback){public_render(dom,callback)},function(nav){if(nav){var navs=jQuery(setting.nav).html(nav).find("a");navs.click(function(e){e.preventDefault();var type=jQuery(this).attr("href");type=type.replace(siteHost.home+"/",""),navs.removeClass("active"),jQuery(this).addClass("active");var channel=jQuery(this).attr("data-parentType");jQuery.cookie("channelpath",channel+"_"+type),$.waterfall.load_index=-1,loadData(type),setting.onRefresh()})}}),0==jQuery(".cell",$container).length&&waterfall.$columns?loadData(setting.type):(waterfall.$columns=creatColumn(),render($(this).find(setting.cell_selector).detach(),!1)),waterfall._scrollTimer2=null,$(window).bind("scroll",function(){clearTimeout(waterfall._scrollTimer2),waterfall._scrollTimer2=setTimeout(function(){onScroll()},300)}),waterfall._scrollTimer3=null,$(window).bind("resize",function(){clearTimeout(waterfall._scrollTimer3),waterfall._scrollTimer3=setTimeout(function(){onResize(),setting.onRefresh()},300)})}}),waterfall._scrollTimer=null;var screenEvent=function(ops){return new screenEvent.fn.init(ops)};screenEvent.fn=screenEvent.prototype={init:function(ops){jQuery.extend(this,ops);{var self=this,ua=window.navigator.userAgent;new RegExp("/("+self.type+")[ ]((d+).(d+))/")}return self.browser=/(msie) ((\d+)\.(\d+))/.exec(ua.toLowerCase()),this},done:function(){var self=this;if(self.browser&&self.browser.length>0&&self.browser[1]==self.type&&self.browser[3]<self.maxVer){self.css&&jQuery(self.dom).css(self.css);var condit=self.condit();"string"==typeof condit?jQuery(self.dom).toggleClass(condit):jQuery(self.dom).css(condit)}return this},browser:function(){return this.browser&&this.browser.length>0?{type:this.browser[1],ver:this.browser[2]}:!1},handle:function(ops){var self=this;return jQuery.each(ops,function(i,obj){jQuery.each(obj.event,function(name,func){jQuery(obj.dom).on(name,function(e){func&&func.call(this,e,function(){self.done()})})})}),this}},screenEvent.fn.init.prototype=screenEvent.fn;var headernav=function(ops){return new headernav.fn.init(ops)};headernav.fn=headernav.prototype={init:function(ops){return jQuery.extend(this,ops),this.assemble(),this},assemble:function(){var self=this;return headernav.loadData(self.activeItem,function(html,data){"1"!=self.activeItem&&jQuery.each(data,function(i,item){return item.id==self.activeItem?(jQuery(function(){document.title=item.name}),!1):void 0});var temp=jQuery("<div></div>").html(html).hide();jQuery(self.dom).html(temp.html()),temp.remove();var items=jQuery(self.dom+" a");items.click(function(e){var type=jQuery(this).attr("href").replace(siteHost.home+"/","");e.preventDefault(),items.removeClass("active"),jQuery(this).addClass("active"),location.href=("1"==type?siteHost.debug?"test_index":"index":siteHost.debug?"test_m":"m")+".html?t="+type})},self),this},contentRefresh:function(type){var self=this;return self.activeItem=type,self.assemble(),this}},headernav.loadData=function(type,eventFunc,self){self.getNavItems?self.getNavItems(type,function(html,data){eventFunc(html,data)}):eventFunc("",[])},headernav.fn.init.prototype=headernav.fn,jQuery.cookie=function(b,j,m){if("undefined"==typeof j){var d=null;if(document.cookie&&""!=document.cookie)for(var k=document.cookie.split(";"),h=0;h<k.length;h++){var c=jQuery.trim(k[h]);if(c.substring(0,b.length+1)==b+"="){d=decodeURIComponent(c.substring(b.length+1));break}}return d}m=m||{},null===j&&(j="",m.expires=-1);var e="";if(m.expires&&("number"==typeof m.expires||m.expires.toUTCString)){var f;"number"==typeof m.expires?(f=new Date,f.setTime(f.getTime()+24*m.expires*60*60*1e3)):f=m.expires,e="; expires="+f.toUTCString()}var l=m.path?"; path="+m.path:"",g=m.domain?"; domain="+m.domain:"",a=m.secure?"; secure":"";document.cookie=[b,"=",encodeURIComponent(j),e,l,g,a].join("")};var scrollExec=function(ops){return scrollExec.fn.init(ops)};scrollExec.fn=scrollExec.prototype={init:function(ops){return jQuery.extend(this,ops),ops.getElemsOffset&&this.getOffset(ops.getElemsOffset),this},getOffset:function(func){var self=this;return self.tops=func(),scrollExec.initScrollEvent(function(top){self.done(top)}),this},done:function(top){var self=this;return jQuery.each(self.tops,function(i,offset){return top+100>=offset.top?(offset.func(),self.tops.splice(i,1),!1):void 0}),this}},scrollExec.initScrollEvent=function(func){jQuery(window).on("scroll",function(){var top=(doc.documentElement.scrollTop||doc.body.scrollTop||0)+jQuery(win).height();func(top)}),jQuery(window).trigger("scroll")},scrollExec.fn.init.prototype=scrollExec.fn;var oldtoTopevent,rightTimeout;return{magazine:magazine,searchbox:searchbox,slidebanner:slideAd,screenEvent:screenEvent,headernav:headernav,scrollExec:scrollExec,imgbanner:function(ops){ops.getBannerItem(function(data,type){var mod;switch(type=parseFloat(type)){case 9:mod=[[2,1],3,[1,1,1]];break;case 2:mod=[[1,2],[2,1],3];break;case 11:case 8:case 7:mod=[[2,1],[1,2],3];break;case 10:case 6:mod=[[2,1],[1,2],[2,1]];break;case 5:case 4:mod=[3,[1,2],[2,1]];break;case 3:mod=[[2,1],[1,2],[1,1,1]]}var colitems=jQuery("<div></div>"),col=0;jQuery.each(["gongge_left","gongge_midd","gongge_right"],function(x,colcls){var item=jQuery("<div></div>").addClass(colcls);colitems.append(item),jQuery.each(mod,function(i,obj){if("number"==typeof obj){var val=data[col];return val&&item.append(jQuery("<div></div>").addClass("ban_h"+obj).html('<a href="'+val.url+'" target="_blank"><img src="'+val.picUrl+'" /></a>')),mod.splice(i,1),col+=1,!1}if("object"==typeof obj){var html=[];return jQuery.each(obj,function(n,xtype){var val=data[col];val&&html.push('<div class="ban_h'+xtype+'"><a href="'+val.url+'" target="_blank"><img src="'+val.picUrl+'" /></a></div>'),col+=1}),item.html(html.join("")),mod.splice(i,1),!1}})}),jQuery(ops.dom).empty().html(colitems.html())})},goTop:function(ops){var dom=jQuery(ops.dom);dom.click(function(e){e.preventDefault(),jQuery("html,body").animate({scrollTop:0})});var bw=/(msie) ((\d+)\.(\d+))/.exec(navigator.userAgent.toLowerCase()),win_scroll=function(){var toTopevent=doc.documentElement.scrollTop||doc.body.scrollTop;oldtoTopevent!=toTopevent&&(clearTimeout(rightTimeout),rightTimeout=setTimeout(function(){var height=jQuery(win).height(),boxheight=dom.height(),toTop=(doc.documentElement.scrollTop||doc.body.scrollTop||0)+(height-boxheight)-20;toTop<screen.height?dom.hide():dom.css({position:"absolute"}).show().stop().animate({top:toTop+"px"},"slow")},0),oldtoTopevent=toTopevent)};bw&&"msie"==bw[1]&&/6/.test(bw[3])?jQuery(win).on("scroll",win_scroll):(jQuery(win).on("scroll",function(){dom.offset().top<screen.height?dom.hide():dom.show()}),jQuery(win).trigger("scroll"))},login:function(ops){var login=jQuery.cookie("mmia_user")||!1,df={uid:"114",usname:"user123",usico:siteHost.home+"/images/user.jpg"};if(login){login=login.split("==");{login[0],login[1]}ops.loginSuccess&&ops.loginSuccess(ops,df)}else ops.noLogin&&ops.noLogin(ops,df)}}});
/*! mmia yandong@mmia.com 最后修改于： 2014-07-03 */