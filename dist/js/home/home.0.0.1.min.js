define(function(require){var controls=require("controls"),api=(require("common"),require("interface")),attentFunc=function(self){var elems=self?jQuery(".img_wrap a,.pinp_logo a",self):jQuery(".img_wrap a,.pinp_logo a"),parent=elems.parent(".cell");(!parent.attr("data-initAttent")||parent.attr("data-initAttent")&&"attent"!=parent.attr("data-initAttent"))&&(parent.attr("data-initAttent","attent"),elems.hover(function(){var parent=jQuery(this).parents(".cell"),isAttent=parent.attr("data-attent")&&"attent"==parent.attr("data-attent")?!0:!1;jQuery(".pinp_logo img",parent).hide(),jQuery(isAttent?".attent_button_ok":".attent_obj",parent).show()},function(){var parent=jQuery(this).parents(".cell"),isAttent=parent.attr("data-attent")&&"attent"==parent.attr("data-attent")?!0:!1;jQuery(".pinp_logo img",parent).show(),jQuery(isAttent?".attent_button_ok":".attent_obj",parent).hide()}))},t=location.search.getQueryString("t"),navtype=t?t:(siteHost.debug?/test_index\.html/:/index\.html/).test(location.href)||!(siteHost.debug?/test_m\.html/:/m\.html/).test(location.href)?"1":"2";controls.goTop({dom:".back_top"}),jQuery(function(){var resize=function(){var width=jQuery(window).width();width>=1200?jQuery("body").removeClass("ie1000 banner_wrap_index1000").addClass("ie1200"):1200>width&&width>1e3?jQuery("body").removeClass("banner_wrap_index1000 ie1200").addClass("ie1000"):jQuery("body").removeClass("ie1200 ie1000").addClass("banner_wrap_index1000")};jQuery(window).on("resize",resize),resize()}),controls.login({loginSuccess:function(target,data){jQuery(".logged,.nologged").length>0&&jQuery(".logged,.nologged").remove();var html=jQuery("#logged").html().tmpl(data),dom=jQuery(html);jQuery(".pageheader").append(dom),jQuery(".uslogout").off("click").on("click",function(e){e.preventDefault(),jQuery.cookie("mmia_user",""),jQuery(".logged").hide(),target.noLogin(target,data)}),jQuery(".usinfo").hover(function(){jQuery(".usinfo_menu").show(),jQuery(this).parents(".right").addClass("user_download2")},function(){jQuery(".usinfo_menu").hide(),jQuery(this).parents(".right").removeClass("user_download2")}),jQuery(".down_app").hover(function(){jQuery(".erwm_wrap",this).show()},function(){jQuery(".erwm_wrap",this).hide()})},noLogin:function(target,data){jQuery(".logged,.nologged").length>0&&jQuery(".logged,.nologged").remove(),jQuery(".pageheader").append(jQuery(jQuery("#nologged").html())),jQuery(".use_login,.use_registr").off("click").on("click",function(e){e.preventDefault(),jQuery(this).hasClass("use_login")?(jQuery(".nologged").hide(),jQuery.cookie("mmia_user","114==user123"),target.loginSuccess(target,data)):location.href=jQuery(this).attr("href").tmpl({host:"http://test.mmia.com",random:Math.random(),url:location.href})}),jQuery(".down_app").hover(function(){jQuery(".erwm_wrap",this).show()},function(){jQuery(".erwm_wrap",this).hide()})}}),controls.searchbox({dom:".searchbox",input:".searchbox_input",submit:".searchbox_button",keybox:".searchbox_keys",getHotword:function(elem){jQuery.get(api.hotword,function(data){data&&"ok"==data.status&&elem.val(data.name||"").attr("data-deftext",data.name||"").addClass("color_gray")},"json")},getKeyItems:function(eventFunc){jQuery.get(api.searchhotkey,function(data){if(data&&"ok"==data.status){var len=data.data&&data.data.length||0,html=[];len>0&&(jQuery.each(data.data,function(i,obj){html.push('<a href="'+obj.url+'"'+(1==obj.isRed?' class="active"':"")+' target="_blank">'+obj.word+"</a>"+(i+1>=len?"":"|"))}),eventFunc(html.join("")))}},"json")}}),controls.headernav({dom:".headernav_items",activeItem:navtype,getNavItems:function(type,eventFunc){jQuery.get(api.channels,function(data){if(data&&"ok"==data.status){var html=[],len=data.data&&data.data.length||0;len>0&&(jQuery.each(data.data,function(i,item){html.push("<li"+(type==item.id?' class="active"':"")+'><a href="'+item.id+'">'+item.name+"</a></li>")}),eventFunc(html.join(""),data.data))}},"json")}}),"1"==navtype?controls.slidebanner({list:".banner_list",view:".banner_view",time:600,waitTime:600,intervalTime:2e3,getBannerItem:function(self,eventFunc){jQuery.get(api.homebanner,function(data){if(data&&"ok"==data.status){var html=[],shtml=[],len=data.data&&data.data.length||0;len>0&&(jQuery.each(data.data,function(i,obj){obj.bigbanner='<div><a href="'+obj.url+'" target="_blank"><img src="'+obj.bigPic+'" alt="" title="" /></a></div>',obj.smallbanner='<a href="'+obj.url+'" target="_blank"><img src="'+obj.smallPic+'" alt="" title="" /></a>',html.push(obj.bigbanner),shtml.push(obj.smallbanner)}),jQuery(".banner_wrap_index").html(jQuery("#homebanner").html().tmpl({bigbanner:html.join(""),smallbanner:shtml.join("")})),eventFunc())}},"json")}}):controls.imgbanner({dom:".channel_banner",getBannerItem:function(eventFunc){jQuery.get(api.channelbanner.tmpl({channelId:navtype}),function(data){if(data&&"ok"==data.status){var len=data.data&&data.data.length||0;len>0&&eventFunc(data.data,navtype)}},"json")}}),controls.scrollExec({getElemsOffset:function(){var func=[{top:jQuery(".new_magazine_box").offset().top,func:function(){controls.magazine({box:".new_magazine_box",list:".magazine_items",getMagazineItems:function(eventFunc){jQuery.get(api.magazine.tmpl({n:10,channelId:navtype}),function(data){if(data&&"ok"==data.status){var html=[],len=data.data&&data.data.length||0;len>0&&(jQuery.each(data.data,function(i,obj){html.push('<li><a href="'+obj.url+'" target="_blank"><img src="'+obj.pictureUrl+'" /></a></li>')}),eventFunc(html.join("")))}},"json")}})}},{top:jQuery(".waterfall_wrap").offset().top,func:function(){function loadData(index,type,render){if(!loaded){var loadmore=jQuery(".load_more");if(index>=4)return void loadmore.html("已经到底...").show().css({opacity:1}).delay(1e3).animate({opacity:0},"slow",function(){loadmore.hide()});loadmore.html("正在加载...").show().css({opacity:1}),loaded=!0,jQuery.get(api.hotmaga.tmpl({p:index,cId:type,channelId:navtype}),function(data){if(data&&"ok"==data.status){var html=[],len=data.data&&data.data.length||0;if(len>0){var mod=jQuery("#waterfall_items").html();jQuery.each(data.data,function(i,obj){return i+1>20?!1:void html.push(mod.tmpl(obj))});var $element=jQuery(html.join(""));render($element,function(){loadmore.css({opacity:1}).hide()}),loaded=!1}else loaded=!1,loadmore.css({opacity:1}).hide()}},"json")}}attentFunc();var loaded=!1;jQuery("#container").waterfall({column_width:230,column_space:10,auto_imgHeight:!0,insert_type:1,itemInit:function(elem){attentFunc(elem),jQuery(".attent_obj",elem).click(function(e){e.preventDefault(),jQuery(this).hide();var parent=jQuery(this).parent();jQuery(".attent_button_ok",parent).show(),parent.parents(".cell").attr("data-attent","attent")})},createColumn:function(data,column_num){for(var html=[],i=0;column_num>i;i++)html.push('<div class="'+data.column_className+'" style="width:'+data.column_width+"px; display:inline-block; *display:inline;zoom:1; margin-left:"+data.column_space/2+"px;margin-right:"+data.column_space/2+'px; vertical-align:top; overflow:hidden"></div>');return html.join("")},getColumnItems:function(index,type,render){loadData(index,type,render)},onRefresh:function(){attentFunc()},type:"1",nav:".waterfall_nav",getNavItems:function(type,render,eventFunc){var cookie=jQuery.cookie("channelpath")&&jQuery.cookie("channelpath").split("_"),id=cookie&&cookie[0]||navtype;type=cookie&&id==navtype&&cookie[1]||type,jQuery.get(api.categroy.tmpl({channelId:navtype}),function(data){if(data&&"ok"==data.status){var html=[],len=data.data&&data.data.length||0;len>0&&(jQuery.each(data.data,function(i,obj){html.push('<a href="'+obj.id+'"'+(obj.id==type?' class="active"':"")+' data-parentType="'+navtype+'">'+obj.category+"</a>"+(i+1>=len?"":"<span>.</span>")),obj.id==type&&loadData(0,type,render)}),eventFunc(html.join("")))}},"json")}})}}];return func}}),jQuery(window).trigger("scroll")});
/*! mmia yandong@mmia.com 最后修改于： 2014-07-03 */